:PROPERTIES:
:ID:       8fe406bb-a24c-41c4-824c-1e2d70594d4b
:END:
#+title: Kubernetes Networking

* Resources
- [[id:69d543a9-0941-4dba-8120-7af004a35957][Kubernetes Service]]

* General definitions
- *NAT* - method of mapping an IP address space into another by modifying network address information in the IP header of packets while they are in transit across a traffic routing device
  - [[https://en.wikipedia.org/wiki/Network_address_translation][wiki]]

* "Rules" of k8s networking
- All nodes can talk
- All pods can talk (without NAT)
- Every pod gets its own IP

* Basics
** Networks
*** Node network
- k8s doesn't implement it
- 443 (HTTPS)
- Pod networking

*** Pod network
- implements a network plugin interface CNI (container network interface)
- big & flat
- 3rd parties provide plugins that implement the pod network
- across all nodes
- all pods have an IP on it
- nodes get a range of addresses on it (eg. 10.0.1.0/24)

*** Service network
- not really a network

* Kube-proxy
- every node on a network has this process running
- writes IPVS/IPTABLES rules on each node
  - svc address  ---  pod address

** IPTABLES mode
- default since Kubernetes 1.2
- doesn't scale well
- not designed for load balancing

** IPVS mode
- stable since Kubernetes 1.11
- uses Linux kernel IP Virtual Server
- Native Layer-4 load balancer
- Supports more algorithms
